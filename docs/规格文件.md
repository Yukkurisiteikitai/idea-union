# 基于LM Studio的服务创意生成系统 规格说明书

## 概要
本系统利用 LM Studio 的大型语言模型 (LLM)，通过组合多个元素自动生成创新的服务创意，并从中筛选出优秀创意的工具。它从 CSV 文件读取元素，进行 AI 驱动的前瞻性服务设计。

## 系统要求
- Python 3.8 或更高版本
- LM Studio（本地 LLM 服务器）
- 所需的 Python 包：
  - openai（AsyncOpenAI）
  - asyncio
  - 其他标准库（csv, random, json, time, os, datetime, signal, sys）

## 配置参数

| 变量名 | 默认值 | 说明 |
|:--|:--|:--|
| LMSTUDIO_BASE_URL | "http://localhost:1234/v1" | LM Studio 的 API 端点 URL。在启动 LM Studio 并按下“Start”按钮后显示的 URL 后追加 `/v1`。 |
| API_KEY | "lm-studio" | 用于 LM Studio API 认证的密钥。虽然是 OpenAI 兼容 API 所必需的，但实际上不进行认证。 |
| MODEL_NAME | "gemma-3-12b-it" | 要使用的 LLM 模型名称。也可使用 "deepseek-r1-distill-qwen-32b" 或 "qwen2.5-bakeneko-32b-instruct" 等。 |
| CSV_FILENAME | "q.csv" | 包含用于生成创意的元素列表的 CSV 文件名。 |
| GOOD_SERVICE_FILENAME | "good-service.json" | 保存筛选出的优秀服务创意的 JSON 文件名。 |
| ALL_IDEAS_FILENAME_PREFIX | "all_ideas_" | 保存所有生成创意的 文件名前缀。实际文件名将在此基础上添加时间戳。 |
| IDEAS_PER_CYCLE | 5 | 每个周期生成的创意数量。 |
| NUM_ELEMENTS_TO_COMBINE | 3 | 生成创意时组合的元素数量。以“〇〇 × △△ × ◇◇”的形式组合 3 个元素。 |

## 系统提示词
系统设置了两种提示词：

1.  **前瞻性设计师提示词 (VISIONARY_DESIGNER_SYS_PROMPT)**：
    - 生成创意时使用的详细系统提示词
    - 提供作为前瞻性服务设计师的角色和创意生成指南
    - 包含概念核心、体验设计、社会实施路线图等视角

2.  **筛选提示词 (SELECTION_SYS_PROMPT)**：
    - 用于从生成的创意中筛选优秀创意时使用的提示词
    - 设定作为业务分析师的评估视角

## 主要功能

### 1. 初始化与连接测试
- 初始化 AsyncOpenAI 客户端
- 测试与 LM Studio API 的连接

### 2. 从 CSV 读取元素
- 从指定的 CSV 文件读取元素列表
- 验证是否有足够的元素数量

### 3. 服务创意生成
- 基于随机选择的元素组合，由 AI 生成服务创意
- 通过异步处理并行生成 IDEAS_PER_CYCLE 个创意
- 从生成的创意中提取以下信息：
  - 使用的元素组合
  - 服务名称（从 AI 回答中提取）
  - 创意的详细文本 (raw_text)

### 4. 最佳创意筛选
- 从生成的创意中筛选出最多 3 个优秀创意
- 输出包含创意编号、服务名称和筛选理由的结果

### 5. 数据保存
- 将所有生成的创意保存到带时间戳的 JSON 文件中
- 将筛选出的优秀创意保存到指定的 JSON 文件中

### 6. 控制流
- 按周期处理
- 信号处理（通过 Ctrl+C 安全停止）
- 通过异步处理实现高效执行

## 执行流程
1. 初始化 OpenAI 客户端
2. 测试 API 连接
3. 从 CSV 文件读取元素
4. 在每个周期执行以下操作：
   - 根据随机元素组合创建创意生成任务
   - 并行处理生成创意
   - 将所有生成的创意保存到 JSON 文件
   - 筛选最佳创意并保存到另一个 JSON 文件
   - 等待下一个周期（5 秒）
5. 接收到信号或发生错误时安全终止

## 错误处理
- 客户端初始化错误
- API 连接错误
- 文件读取错误
- 元素数量不足错误
- 创意生成过程中的错误
- 最佳创意筛选过程中的错误
- 文件保存错误

## 限制条件
- 需要 LM Studio 正在运行且模型已加载
- CSV 文件需要包含足够数量的元素（不少于 NUM_ELEMENTS_TO_COMBINE）
- 由于执行大量并行处理，需要系统资源充足

## 输出文件
1.  **all_ideas_[时间戳].json**：每个周期生成的所有创意
2.  **good-service.json**：每个周期筛选出的优秀创意（最多 3 个）